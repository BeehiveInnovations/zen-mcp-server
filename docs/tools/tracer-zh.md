# Tracer工具 - 静态代码分析提示生成器

**为调用流映射和依赖跟踪创建详细分析提示**

`tracer`工具是一个专门的提示生成工具，为Claude创建结构化分析请求以执行全面的静态代码分析。此工具不是将整个项目传递给另一个模型，而是生成Claude可以用来高效跟踪执行流程并映射代码库内依赖关系的聚焦提示。

## 两种分析模式

**`precision`模式**：用于方法/函数
- 跟踪执行流程、调用链和使用模式
- 详细分支分析和副作用
- 显示函数在整个系统中何时以及如何被调用

**`dependencies`模式**：用于类/模块/协议
- 映射双向依赖关系和结构关系
- 识别耦合和架构依赖
- 显示组件如何交互和相互依赖

## 关键功能

- **生成全面分析提示**而不是直接执行分析
- **比外部模型的完整项目分析更快更高效**
- **创建结构化指令**用于调用流图生成
- **提供详细格式要求**以获得一致输出
- **支持任何编程语言**，具有自动约定检测
- **输出可用作另一个工具的输入**，如`chat`以及相关代码文件来执行逻辑调用流分析
- **图像支持**：分析视觉调用流图、序列图：`"使用序列图为这个支付流程生成tracer分析"`

## 工具参数

- `prompt`：要跟踪的内容的详细描述以及为什么需要此分析（必需）
- `trace_mode`：precision|dependencies（必需）
- `images`：系统架构图、流程图或视觉参考的可选图像（绝对路径）

## 使用示例

**方法执行跟踪：**
```
"使用zen tracer分析UserAuthManager.authenticate如何使用以及为什么"
```
→ 使用`precision`模式跟踪方法的执行流程

**类依赖映射：**
```
"使用zen为PaymentProcessor类生成依赖跟踪以了解其关系"
```
→ 使用`dependencies`模式映射结构关系

**带视觉上下文：**
```
"使用此序列图为认证流程生成tracer分析"
```

**复杂系统分析：**
```
"创建tracer提示以了解OrderProcessor.processPayment方法如何流经整个系统"
```

## Precision模式输出

当为方法/函数使用`precision`模式时，工具生成的提示将帮助Claude创建：

**调用链分析：**
- 方法定义位置
- 调用它的所有位置
- 直接和间接调用者
- 调用层次和深度

**执行流映射：**
- 逐步执行路径
- 分支条件和逻辑
- 副作用和状态更改
- 返回值使用

**使用模式分析：**
- 调用频率和上下文
- 参数传递模式
- 错误处理方法
- 性能影响

## Dependencies模式输出

当为类/模块使用`dependencies`模式时，工具生成的提示将帮助Claude创建：

**结构关系：**
- 继承层次
- 组合和聚合
- 接口实现
- 模块导入和导出

**双向依赖：**
- 组件依赖什么
- 什么依赖组件
- 循环依赖
- 耦合强度分析

**架构影响：**
- 层违规
- 依赖倒置机会
- 重构影响评估
- 可测试性影响

## 生成提示示例

**Precision模式：**
```
分析UserAuthManager中`authenticate`方法的执行流程和使用：

1. **方法位置**：找到UserAuthManager.authenticate定义位置
2. **调用站点**：识别调用此方法的所有位置
3. **执行流程**：跟踪逐步执行路径
4. **副作用**：记录状态更改和外部交互
5. **返回处理**：显示调用者如何使用返回值

将分析格式化为：
- 方法签名和位置
- 调用层次（直接和间接调用者）
- 执行流程图
- 副作用和依赖
- 使用模式和频率
```

**Dependencies模式：**
```
映射PaymentProcessor类的结构依赖：

1. **直接依赖**：PaymentProcessor直接导入/使用什么
2. **反向依赖**：哪些类/模块依赖PaymentProcessor
3. **继承关系**：父类和实现的接口
4. **组合**：PaymentProcessor包含或创建的对象

将分析格式化为：
- 依赖图（传入和传出）
- 架构层分析
- 耦合评估
- 重构影响评估
```

## 最佳实践

- **明确目标**：清楚说明您需要理解什么以及为什么
- **描述上下文**：提及您是在调试、重构还是学习代码库
- **选择适当模式**：方法流使用`precision`，架构使用`dependencies`
- **包含视觉上下文**：可用时引用图表或文档
- **跟进分析**：将生成的提示与`chat`或`analyze`工具一起使用

## 与其他工具的集成

`tracer`工具与其他分析工具结合使用效果最佳：

**Tracer + Chat：**
```
1. 用tracer生成分析提示
2. 将提示与chat工具和相关代码文件一起使用
3. 获得详细的调用流或依赖分析
```

**Tracer + Analyze：**
```
1. 使用tracer创建结构化分析提示
2. 使用analyze工具应用提示进行系统代码探索
3. 获得架构见解和依赖映射
```

## 何时使用Tracer与其他工具

- **使用`tracer`**：创建结构化分析提示、系统代码探索规划
- **使用`analyze`**：直接代码分析而不生成提示
- **使用`debug`**：特定运行时错误调查
- **使用`chat`**：开放式代码讨论和探索
