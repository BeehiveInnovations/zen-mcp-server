# Secaudit工具 - 全面安全审计

**通过工作流驱动调查进行基于OWASP的系统化安全评估和合规性评估**

`secaudit`工具提供全面的安全审计能力，包括系统化OWASP Top 10评估、合规框架评估和威胁建模。此工作流工具指导Claude通过有条理的安全调查步骤，在每个步骤之间强制暂停，以确保彻底的漏洞评估、安全模式分析和合规性验证，然后提供专家分析。

**重要**：AI模型可能无法识别所有安全漏洞。始终执行额外的手动安全审查、渗透测试和验证。

## 工作流如何运作

secaudit工具实现了**结构化的6步安全工作流**，确保全面的安全评估：

**调查阶段（Claude主导）：**
1. **步骤1**：安全范围分析 - Claude识别应用程序类型、技术栈、攻击面和合规要求
2. **步骤2**：认证与授权评估 - 分析认证机制、会话管理和访问控制
3. **步骤3**：输入验证与数据安全 - 审查输入处理、数据保护和注入漏洞
4. **步骤4**：OWASP Top 10（2021）审查 - 系统评估所有OWASP类别的具体发现
5. **步骤5**：依赖与基础设施 - 第三方组件和部署配置的安全分析
6. **步骤6**：合规性与风险评估 - 针对指定合规框架评估和风险优先级排序

**专家分析阶段：**
在Claude完成调查后（除非置信度为**certain**）：
- 包含所有漏洞和证据的完整安全评估摘要
- 具有严重性分类的OWASP Top 10系统发现
- 合规框架差距分析和修复建议
- 基于威胁级别和业务影响的风险优先修复路线图

**特别说明**：如果您希望Claude执行整个安全审计而不调用其他模型，可以在提示中包含"不使用任何其他模型"，Claude将独立完成完整工作流。

## 模型推荐

由于Gemini Pro或O3模型具有高级推理能力和大上下文窗口，这个工具特别受益于它们，可以对复杂代码库进行全面安全分析。安全审计需要理解微妙的攻击向量和跨组件交互，这受益于更深的分析能力。

## 示例提示

```
用o3对这个电子商务Web应用执行secaudit，专注于支付处理安全和PCI DSS合规性
```

```
使用secaudit对认证系统进行全面安全审计，威胁级别高，专注于企业
安全模式和HIPAA合规性
```

## 专业提示：多范围安全评估

**您可以为不同应用组件运行并行安全审计：**

```
启动单独的子任务，在一个中用gemini pro开始对关键支付处理组件进行专注于PCI DSS的secaudit，
在另一个中用o4-mini对专注于OWASP认证漏洞的用户管理进行secaudit，然后使用planner合并为统一的
安全修复计划
```

## 关键功能

- **OWASP Top 10（2021）系统评估**，具有特定漏洞识别
- **多合规框架支持**：SOC2、PCI DSS、HIPAA、GDPR、FedRAMP
- **威胁级别感知分析**：关键、高、中、低威胁分类
- **技术特定安全模式**：Web应用、API、移动、云、企业系统
- **基于风险的优先级排序**：业务影响和可利用性评估
- **审计焦点定制**：全面、认证、数据保护、基础设施
- **图像支持**：从架构图、网络拓扑或安全发现进行安全分析
- **多文件安全分析**：跨组件漏洞识别
- **合规差距分析**：特定框架要求和修复指导
- **攻击面映射**：入口点、数据流和特权边界
- **安全控制有效性**：现有安全措施的评估

## 工具参数

**工作流调查参数（在逐步过程中使用）：**
- `step`：当前安全调查步骤描述（每个步骤必需）
- `step_number`：审计序列中的当前步骤号（必需）
- `total_steps`：估计的总调查步骤数（通常4-6，可调整）
- `next_step_required`：是否需要另一个调查步骤
- `findings`：此步骤中收集的安全发现和证据（必需）
- `files_checked`：安全调查期间检查的所有文件
- `relevant_files`：与安全评估直接相关的文件（步骤1中必需）
- `relevant_context`：安全发现核心的方法/函数/类
- `issues_found`：识别的安全问题及严重性级别
- `confidence`：安全评估完整性的置信度（exploring/low/medium/high/certain）
- `backtrack_from_step`：要回溯的步骤号（用于修订）
- `images`：架构图、安全文档或视觉参考

**初始安全配置（在步骤1中使用）：**
- `model`：auto|pro|flash|flash-2.0|flashlite|o3|o3-mini|o4-mini|gpt4.1|gpt5|gpt5-mini|gpt5-nano（默认：服务器默认）
- `security_scope`：应用上下文、技术栈和安全边界定义（必需）
- `threat_level`：low|medium|high|critical（默认：medium） - 确定评估深度和紧急性
- `compliance_requirements`：要评估的合规框架列表（如["PCI DSS", "SOC2"]）
- `audit_focus`：comprehensive|authentication|data_protection|infrastructure|api_security（默认：comprehensive）
- `severity_filter`：critical|high|medium|low|all（默认：all）
- `temperature`：分析一致性的温度（0-1，默认0.2）
- `thinking_mode`：minimal|low|medium|high|max（默认：medium，仅Gemini）
- `use_websearch`：启用安全最佳实践和漏洞数据库的网络搜索（默认：true）
- `use_assistant_model`：是否使用专家安全分析阶段（默认：true）
- `continuation_id`：继续之前的安全审计讨论

## 审计焦点领域

**全面（默认）：**
- 包含所有安全域的完整OWASP Top 10评估
- 认证、授权、数据保护、基础设施
- 最适合完整安全态势评估

**认证：**
- 专注于身份、访问管理和会话安全
- 多因素认证、密码策略、特权升级
- 最适合用户管理和访问控制系统

**数据保护：**
- 加密、数据处理、隐私控制和合规性
- 输入验证、输出编码、数据分类
- 最适合处理敏感或受监管数据的应用

**基础设施：**
- 部署安全、配置管理、依赖安全
- 网络安全、容器安全、云安全态势
- 最适合DevOps和基础设施安全评估

**API安全：**
- REST/GraphQL安全、速率限制、API认证
- 输入验证、授权模式、API网关安全
- 最适合API优先应用和微服务

## 威胁级别

安全评估深度和紧急性：

- **🔴 关键**：任务关键系统、高价值目标、监管要求
- **🟠 高级**：业务关键应用、客户数据处理、金融系统
- **🟡 中等**：标准业务应用、内部工具、中等风险暴露
- **🟢 低级**：开发环境、非敏感应用、概念验证

## 合规框架

支持的合规评估：

- **SOC2**：安全、可用性、处理完整性、机密性、隐私
- **PCI DSS**：支付卡行业数据安全标准
- **HIPAA**：医疗信息隐私和安全
- **GDPR**：通用数据保护条例合规性
- **FedRAMP**：联邦风险和授权管理程序
- **ISO27001**：信息安全管理系统
- **NIST**：网络安全框架控制

## OWASP Top 10（2021）覆盖

系统评估包括：

1. **A01 访问控制失效**：授权缺陷和特权升级
2. **A02 加密失效**：加密和数据保护问题
3. **A03 注入**：SQL、NoSQL、OS和LDAP注入漏洞
4. **A04 不安全设计**：安全设计缺陷和威胁建模差距
5. **A05 安全配置错误**：配置和加固问题
6. **A06 易受攻击组件**：第三方和依赖漏洞
7. **A07 身份和认证失效**：认证绕过和会话管理
8. **A08 软件和数据完整性失效**：供应链和完整性违规
9. **A09 安全日志和监控失效**：检测和响应能力
10. **A10 服务器端请求伪造**：SSRF和相关漏洞

## 使用示例

**全面电子商务安全审计：**
```
"用gemini pro对我们的Node.js电子商务平台进行全面secaudit，威胁级别高，
合规要求PCI DSS和SOC2，专注于支付处理安全"
```

**认证系统安全审查：**
```
"使用o3对认证微服务执行secaudit，专注于认证，
威胁级别关键，检查OWASP A07和多因素认证实施"
```

**API安全评估：**
```
"用gemini pro对我们的REST API网关进行secaudit，审计焦点api_security，
合规要求GDPR，威胁级别中等"
```

**基础设施安全审查：**
```
"用o3对Kubernetes部署清单执行secaudit，专注基础设施，
威胁级别高，包括容器安全和网络策略"
```

**快速安全扫描：**
```
"用flash对用户注册流程进行快速secaudit，专注认证，
严重性过滤仅关键和高级"
```

## 最佳实践

- **定义清楚安全范围**：指定应用类型、技术栈和安全边界
- **设置适当威胁级别**：将评估深度与风险暴露和关键性匹配
- **包含合规要求**：为监管对齐指定相关框架
- **使用并行审计**：为不同组件或合规框架运行单独评估
- **提供架构上下文**：包含系统图、数据流文档或部署拓扑
- **聚焦审计范围**：使用audit_focus对特定安全域进行针对性评估
- **跟进发现**：使用延续功能深入研究特定漏洞

## 输出格式

安全审计包括：
- **执行安全摘要**：整体安全态势和关键发现
- **OWASP Top 10评估**：每个类别的系统审查及具体发现
- **合规差距分析**：特定框架要求和当前合规状态
- **风险优先发现**：按可利用性和业务影响排序的漏洞
- **修复路线图**：分阶段的安全改进方法与快速胜利
- **安全架构建议**：长期安全态势的结构改进

## 何时使用Secaudit与其他工具

- **使用`secaudit`**：全面安全评估、合规评估、基于OWASP的漏洞分析
- **使用`codereview`**：一般代码质量，带一些安全考虑
- **使用`analyze`**：理解安全架构而无漏洞评估
- **使用`debug`**：调查特定安全事件或利用尝试
- **使用`precommit`**：部署前安全验证和更改影响评估
