# Analyze工具 - 智能文件分析

**通过工作流驱动调查进行通用代码理解和探索**

`analyze`工具提供全面的代码分析和理解能力，帮助您探索代码库、理解架构，并识别文件和目录中的模式。这个工作流工具指导Claude通过系统化调查代码结构、模式和架构决策的多个步骤，在提供专家分析之前收集全面的见解。

## 思考模式

**默认为`medium`（8,192 tokens）。** 对于架构分析使用`high`（全面见解值得成本）或对于快速文件概览使用`low`（节省约6k tokens）。

## 工作流如何运作

analyze工具实现了**结构化工作流**以进行彻底的代码理解：

**调查阶段（Claude主导）：**
1. **步骤1**：Claude描述分析计划并开始检查代码结构
2. **步骤2+**：Claude调查架构、模式、依赖关系和设计决策
3. **整个过程**：Claude跟踪发现、相关文件、见解和置信度
4. **完成**：一旦分析全面，Claude发出完成信号

**专家分析阶段：**
在Claude完成调查后（除非置信度为**certain**）：
- 包含所有发现的完整分析摘要
- 架构见解和模式识别
- 战略改进建议
- 基于调查的最终专家评估

这个工作流确保在专家见解之前进行有条理的分析，导致更深入的理解和更有价值的建议。

## 示例提示

**基本用法：**
```
"使用gemini分析main.py以了解它如何工作"
"让gemini对src/目录进行架构分析"
```

## 关键功能

- **分析单个文件或整个目录**，具有智能文件过滤
- **支持专门的分析类型**：architecture、performance、security、quality、general
- **使用文件路径（非内容）以获得清洁的终端输出**，同时处理完整内容
- **可以识别模式、反模式和重构机会**
- **大型代码库支持**：使用1M token上下文模型处理大量代码库
- **跨文件关系映射**：理解依赖关系和交互
- **架构可视化**：描述系统结构和组件关系
- **图像支持**：分析架构图、UML图表、流程图：`"使用gemini分析这个系统图以了解数据流并识别瓶颈"`
- **网络搜索能力**：当启用`use_websearch`（默认：true）时，模型可以请求Claude执行网络搜索并分享结果，以使用当前文档、设计模式和最佳实践增强分析

## 工具参数

**工作流调查参数（在逐步过程中使用）：**
- `step`：当前调查步骤描述（每个步骤必需）
- `step_number`：分析序列中的当前步骤号（必需）
- `total_steps`：估计的总调查步骤数（可调整）
- `next_step_required`：是否需要另一个调查步骤
- `findings`：在此步骤中收集的发现和见解（必需）
- `files_checked`：调查期间检查的所有文件
- `relevant_files`：与分析直接相关的文件（步骤1中必需）
- `relevant_context`：分析发现的核心方法/函数/类
- `issues_found`：发现的问题或关注点及严重性级别
- `confidence`：分析完整性的置信度（exploring/low/medium/high/certain）
- `backtrack_from_step`：要回溯的步骤号（用于修订）
- `images`：分析上下文的视觉参考

**初始配置（在步骤1中使用）：**
- `prompt`：要分析或寻找的内容（必需）
- `model`：auto|pro|flash|flash-2.0|flashlite|o3|o3-mini|o4-mini|gpt4.1|gpt5|gpt5-mini|gpt5-nano（默认：服务器默认）
- `analysis_type`：architecture|performance|security|quality|general（默认：general）
- `output_format`：summary|detailed|actionable（默认：detailed）
- `temperature`：分析温度（0-1，默认0.2）
- `thinking_mode`：minimal|low|medium|high|max（默认：medium，仅Gemini）
- `use_websearch`：启用文档和最佳实践的网络搜索（默认：true）
- `use_assistant_model`：是否使用专家分析阶段（默认：true，设置为false仅使用Claude）
- `continuation_id`：继续之前的分析会话

## 分析类型

**通用分析（默认）：**
- 整体代码结构和组织
- 关键组件及其职责
- 数据流和控制流
- 设计模式和架构决策

**架构分析：**
- 系统级设计和组件关系
- 模块依赖和耦合
- 关注点分离和分层
- 可扩展性和可维护性考虑

**性能分析：**
- 潜在瓶颈和优化机会
- 算法复杂度评估
- 内存使用模式
- I/O和数据库交互效率

**安全分析：**
- 安全模式和潜在漏洞
- 输入验证和清理
- 认证和授权机制
- 数据保护和隐私考虑

**质量分析：**
- 代码质量指标和可维护性
- 测试覆盖率和模式
- 文档完整性
- 最佳实践遵守

## 使用示例

**单文件分析：**
```
"用gemini分析user_controller.py以了解认证流程"
```

**目录架构分析：**
```
"使用pro分析src/目录架构并识别主要组件"
```

**性能重点分析：**
```
"用o3分析backend/api/的性能瓶颈，重点关注数据库查询"
```

**安全评估：**
```
"使用gemini pro分析认证模块的安全模式和潜在问题"
```

**视觉+代码分析：**
```
"分析这个系统架构图以及src/core/实现以了解数据流"
```

**大型代码库分析：**
```
"用gemini pro分析整个项目结构以了解所有组件如何协同工作"
```

## 输出格式

**摘要格式：**
- 包含关键发现的高级概览
- 主要组件及其目的
- 关键见解和建议

**详细格式（默认）：**
- 包含具体示例的全面分析
- 代码片段和文件引用
- 模式和结构的详细解释

**可行格式：**
- 具体建议和后续步骤
- 改进的优先级列表
- 实施指导和示例

## 最佳实践

- **明确目标**：清楚说明您想要理解或发现什么
- **使用适当的分析类型**：选择匹配您需求的类型
- **包含相关文件**：一起分析模块以获得更好的上下文理解
- **利用大上下文模型**：使用Gemini Pro进行全面的代码库分析
- **结合视觉上下文**：包含架构图或文档
- **使用延续**：在之前的分析基础上构建以获得更深入的理解

## 高级功能

**大型代码库支持：**
使用像Gemini Pro（1M上下文）这样的模型，您可以分析广泛的代码库：
```
"分析所有服务目录中的整个微服务架构"
```

**跨文件关系映射：**
了解组件如何跨多个文件交互：
```
"分析跨input/、processing/和output/目录的数据处理管道"
```

**模式识别：**
识别设计模式、反模式和架构决策：
```
"分析src/以识别使用的所有设计模式并评估其实现质量"
```

**网络搜索增强：**
该工具可以推荐搜索当前最佳实践和文档：
```
分析后："Claude推荐搜索：'FastAPI async best practices 2024'、'SQLAlchemy ORM performance optimization patterns'"
```

## 何时使用Analyze与其他工具

- **使用`analyze`**：理解代码结构、探索陌生代码库、架构评估
- **使用`codereview`**：找到错误和安全问题以及可行的修复
- **使用`debug`**：诊断特定的运行时错误或性能问题
- **使用`refactor`**：获得特定的重构建议和实施计划
- **使用`chat`**：关于代码的开放式讨论，无需结构化分析
