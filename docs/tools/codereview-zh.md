# CodeReview工具 - 专业代码审查

**通过工作流驱动调查进行全面代码分析与优先级反馈**

`codereview`工具提供专业的代码审查能力，具有可行的反馈、基于严重性的问题优先级，并支持从快速样式检查到全面安全审计的各种审查类型。这个工作流工具指导Claude通过系统化调查步骤，在每个步骤之间强制暂停，以确保彻底的代码检查、问题识别和质量评估，然后提供专家分析。

## 思考模式

**默认为`medium`（8,192 tokens）。** 对于安全关键代码使用`high`（值得额外tokens）或对于快速样式检查使用`low`（节省约6k tokens）。

## 工作流如何运作

codereview工具实现了**结构化工作流**以确保彻底的代码检查：

**调查阶段（Claude主导）：**
1. **步骤1**：Claude描述审查计划并开始系统分析代码结构
2. **步骤2+**：Claude检查代码质量、安全影响、性能关注和架构模式
3. **整个过程**：Claude跟踪发现、相关文件、问题和置信度
4. **完成**：一旦审查全面，Claude发出完成信号

**专家分析阶段：**
在Claude完成调查后（除非置信度为**certain**）：
- 包含所有发现和证据的完整审查摘要
- 识别的相关文件和代码模式
- 按严重性级别分类的问题
- 基于调查的最终建议

**特别说明**：如果您希望Claude执行整个审查而不调用其他模型，可以在提示中包含"不使用任何其他模型"，Claude将独立完成完整工作流。

## 模型推荐

由于Gemini Pro或Flash模型具有1M上下文窗口，这个工具特别受益于它们，可以全面分析大型代码库。Claude的上下文限制使得在复杂项目中难以看到"大局" - 这是一个具体的例子，说明利用具有更大上下文的次要模型提供了超越仅仅实验不同AI能力的显著价值。

## 示例提示

```
用gemini pro执行代码审查并审查auth.py的安全问题和潜在漏洞。
我需要一个可行的计划，但将其分解为我们可以快速实施和测试的小的快速胜利
```

## 专业提示：多个并行审查

**您可以与Claude启动多个代码审查会话：**

```
为代码审查启动单独的子任务，一个用o3找到关键问题，一个用flash找到低优先级问题
和快速胜利，并给我最终的单一组合审查，只突出关键问题
```

上述提示将同时运行两个单独的`codereview`工具，使用两个单独的模型，并将输出合并为您使用的单一摘要。

## 关键功能

- **按严重性优先排序的问题**（🔴 关键 → 🟢 低级）
- **支持专门审查**：security、performance、quick
- **编码标准执行**：`"使用gemini根据PEP8标准审查src/"`
- **严重性过滤**：`"让gemini审查auth/ - 只报告关键漏洞"`
- **图像支持**：审查屏幕截图、错误对话框或视觉错误报告中的代码：`"审查这个错误屏幕截图和相关的auth.py文件以发现潜在的安全问题"`
- **多文件分析**：整个目录或代码库的全面审查
- **可行反馈**：具有行号和代码示例的具体建议
- **特定语言专业知识**：针对Python、JavaScript、Java、C#、Swift等的定制分析
- **集成问题检测**：识别跨文件依赖和架构问题
- **安全漏洞扫描**：专注于常见的安全模式和反模式

## 工具参数

**工作流调查参数（在逐步过程中使用）：**
- `step`：当前调查步骤描述（每个步骤必需）
- `step_number`：审查序列中的当前步骤号（必需）
- `total_steps`：估计的总调查步骤数（可调整）
- `next_step_required`：是否需要另一个调查步骤
- `findings`：在此步骤中收集的发现和证据（必需）
- `files_checked`：调查期间检查的所有文件
- `relevant_files`：与审查直接相关的文件（步骤1中必需）
- `relevant_context`：审查发现的核心方法/函数/类
- `issues_found`：识别的问题及严重性级别
- `confidence`：审查完整性的置信度（exploring/low/medium/high/certain）
- `backtrack_from_step`：要回溯的步骤号（用于修订）
- `images`：审查上下文的视觉参考

**初始审查配置（在步骤1中使用）：**
- `prompt`：用户对代码功能、预期行为、约束和审查目标的摘要（必需）
- `model`：auto|pro|flash|flash-2.0|flashlite|o3|o3-mini|o4-mini|gpt4.1|gpt5|gpt5-mini|gpt5-nano（默认：服务器默认）
- `review_type`：full|security|performance|quick（默认：full）
- `focus_on`：要关注的具体方面（如"安全漏洞"、"性能瓶颈"）
- `standards`：要执行的编码标准（如"PEP8"、"ESLint"、"Google Style Guide"）
- `severity_filter`：critical|high|medium|low|all（默认：all）
- `temperature`：一致性温度（0-1，默认0.2）
- `thinking_mode`：minimal|low|medium|high|max（默认：medium，仅Gemini）
- `use_websearch`：启用最佳实践和文档的网络搜索（默认：true）
- `use_assistant_model`：是否使用专家分析阶段（默认：true，设置为false仅使用Claude）
- `continuation_id`：继续之前的审查讨论

## 审查类型

**完整审查（默认）：**
- 包括错误、安全、性能、可维护性的全面分析
- 最适合新功能或重大代码更改

**安全审查：**
- 专注于安全漏洞和攻击向量
- 检查常见的安全反模式
- 最适合认证、授权、数据处理代码

**性能审查：**
- 分析性能瓶颈和优化机会
- 内存使用、算法复杂度、资源管理
- 最适合性能关键代码路径

**快速审查：**
- 快速样式和基本问题检查
- 较低的token使用以获得快速反馈
- 最适合代码格式化和简单验证

## 严重性级别

问题被分类和优先排序：

- **🔴 关键**：安全漏洞、崩溃、数据损坏
- **🟠 高级**：逻辑错误、性能问题、可靠性问题
- **🟡 中等**：代码异味、可维护性问题、小错误
- **🟢 低级**：样式问题、文档、小改进

## 使用示例

**基本安全审查：**
```
"用gemini pro审查auth/中的认证模块以发现安全漏洞"
```

**性能重点审查：**
```
"使用o3审查backend/api.py的性能问题，重点关注数据库查询和缓存"
```

**快速样式检查：**
```
"用flash快速审查utils.py，只报告关键和高严重性问题"
```

**标准执行：**
```
"用gemini根据PEP8标准审查src/目录，重点关注代码格式和结构"
```

**视觉上下文审查：**
```
"审查这个认证代码以及错误对话框屏幕截图以了解安全影响"
```

## 最佳实践

- **提供上下文**：描述代码应该做什么以及任何约束
- **使用适当的审查类型**：安全用于认证代码，性能用于关键路径
- **设置严重性过滤器**：专注于关键问题以获得快速胜利
- **包含相关文件**：一起审查相关模块以获得更好的上下文
- **使用并行审查**：与不同模型运行多个审查以获得全面覆盖
- **跟进发现**：使用延续功能详细讨论具体问题

## 输出格式

审查包括：
- **执行摘要**：代码质量和主要关注点的概览
- **详细发现**：具有严重性级别、行号和建议的具体问题
- **快速胜利**：易于实施的高影响改进
- **长期改进**：更好可维护性的结构性更改
- **安全考虑**：相关时的具体安全建议

## 何时使用CodeReview与其他工具

- **使用`codereview`**：找到错误、安全问题、性能问题、代码质量评估
- **使用`analyze`**：理解代码结构而不查找问题
- **使用`debug`**：诊断特定的运行时错误或异常
- **使用`refactor`**：识别结构改进和现代化机会
