# TestGen工具 - 全面测试生成

**通过工作流驱动调查生成具有边缘情况覆盖的彻底测试套件**

`testgen`工具通过分析您的代码路径、理解复杂依赖关系，并识别需要测试覆盖的现实边缘情况和失败场景来创建全面的测试套件。此工作流工具指导Claude通过多个步骤系统调查代码功能、关键路径、边缘情况和集成点，然后通过现实失败模式分析生成全面测试。

## 思考模式

**扩展思考模型默认为`medium`（8,192 tokens）。** 对于具有许多交互的复杂系统使用`high`，对于需要详尽测试覆盖的关键系统使用`max`。

## 工作流如何运作

testgen工具实现了**结构化工作流**以进行全面测试生成：

**调查阶段（Claude主导）：**
1. **步骤1**：Claude描述测试生成计划并开始分析代码功能
2. **步骤2+**：Claude检查关键路径、边缘情况、错误处理和集成点
3. **整个过程**：Claude跟踪发现、测试场景和覆盖差距
4. **完成**：一旦调查彻底，Claude发出完成信号

**测试生成阶段：**
在Claude完成调查后：
- 包含所有边缘情况的完整测试场景目录
- 特定框架的测试生成
- 现实失败模式覆盖
- 具有全面覆盖的最终测试套件

这个工作流确保在测试生成之前进行有条理的分析，产生更彻底和有价值的测试套件。

## 模型推荐

测试生成在扩展推理模型（如Gemini Pro或O3）上表现出色，它们可以分析复杂的代码路径、理解复杂依赖关系，并识别全面的边缘情况。大上下文窗口和高级推理的结合使得能够生成彻底的测试套件，覆盖较短上下文模型可能忽略的现实失败场景和集成点。

## 示例提示

**基本用法：**
```
"使用zen为User.login()方法生成测试"
"用o3为src/new_sort.py中的排序方法生成全面测试"
"使用gemini pro创建我们测试中尚未覆盖的边缘情况测试"
```

## 关键功能

- **多代理工作流**分析代码路径并识别现实失败模式
- **生成特定框架测试**遵循项目约定
- **支持测试模式跟踪**当提供示例时
- **动态token分配**（25%用于测试示例，75%用于主代码）
- **优先考虑最小测试文件**用于模式检测
- **可以参考现有测试文件**：`"按照tests/unit/的模式生成测试"`
- **特定代码覆盖** - 针对特定函数/类而不是测试所有内容
- **图像支持**：测试UI组件，分析视觉需求：`"使用登录表单UI模型屏幕截图为此登录表单生成测试"`
- **边缘情况识别**：系统发现边界条件和错误状态
- **现实失败模式分析**：理解生产中实际可能出错的情况
- **集成测试支持**：覆盖组件交互和系统边界的测试

## 工具参数

**工作流调查参数（在逐步过程中使用）：**
- `step`：当前调查步骤描述（每个步骤必需）
- `step_number`：测试生成序列中的当前步骤号（必需）
- `total_steps`：估计的总调查步骤数（可调整）
- `next_step_required`：是否需要另一个调查步骤
- `findings`：关于功能和测试场景的发现（必需）
- `files_checked`：调查期间检查的所有文件
- `relevant_files`：直接需要测试的文件（步骤1中必需）
- `relevant_context`：需要测试覆盖的方法/函数/类
- `confidence`：测试计划完整性的置信度（exploring/low/medium/high/certain）
- `backtrack_from_step`：要回溯的步骤号（用于修订）

**初始配置（在步骤1中使用）：**
- `prompt`：要测试的内容、测试目标和特定范围/关注领域的描述（必需）
- `model`：auto|pro|flash|flash-2.0|flashlite|o3|o3-mini|o4-mini|gpt4.1|gpt5|gpt5-mini|gpt5-nano（默认：服务器默认）
- `test_examples`：作为样式/模式参考的可选现有测试文件或目录（绝对路径）
- `thinking_mode`：minimal|low|medium|high|max（默认：medium，仅Gemini）
- `use_assistant_model`：是否使用专家测试生成阶段（默认：true，设置为false仅使用Claude）

## 使用示例

**特定方法测试：**
```
"为User.login()方法生成覆盖认证成功、失败和边缘情况的测试"
```

**类测试：**
```
"使用pro和max思考模式为PaymentProcessor类生成全面测试"
```

**遵循现有模式：**
```
"按照tests/unit/auth/的模式为新认证模块生成测试"
```

**UI组件测试：**
```
"使用UI模型屏幕截图为这个登录表单组件生成测试"
```

**算法测试：**
```
"为utils/sort.py中的排序算法创建彻底测试，专注于边缘情况和性能"
```

**集成测试：**
```
"为从订单创建到完成的支付处理管道生成集成测试"
```

## 测试生成策略

**代码路径分析：**
- 识别通过代码的所有执行路径
- 映射条件分支和循环
- 发现错误处理路径
- 分析状态转换

**边缘情况发现：**
- 边界值分析（空、空值、最大值）
- 无效输入场景
- 竞态条件和时序问题
- 资源耗尽情况

**失败模式分析：**
- 外部依赖失败
- 网络和I/O错误
- 认证和授权失败
- 数据损坏场景

**框架检测：**
该工具自动检测并为以下框架生成测试：
- **Python**：pytest、unittest、nose2
- **JavaScript**：Jest、Mocha、Jasmine、Vitest
- **Java**：JUnit 4/5、TestNG、Mockito
- **C#**：NUnit、MSTest、xUnit
- **Swift**：XCTest
- **Go**：testing包
- **等等**：适应项目约定

## 生成的测试类别

**单元测试：**
- 函数/方法行为验证
- 输入/输出验证
- 错误条件处理
- 状态更改验证

**集成测试：**
- 组件交互测试
- API端点验证
- 数据库集成
- 外部服务模拟

**边缘情况测试：**
- 边界条件
- 无效输入
- 资源限制
- 并发访问

**性能测试：**
- 响应时间验证
- 内存使用检查
- 负载处理
- 可扩展性验证

## 最佳实践

- **明确范围**：针对特定函数/类而不是请求测试所有内容
- **提供测试示例**：包含现有测试文件以保持模式一致性
- **专注于关键路径**：优先测试业务关键功能
- **包含视觉上下文**：UI组件测试的屏幕截图或模型
- **描述测试目标**：解释测试的哪些方面最重要
- **考虑测试维护**：请求可读、可维护的测试代码

## 测试质量功能

**现实测试数据：**
- 生成代表真实世界场景的有意义测试数据
- 避免不增加价值的琐碎测试用例
- 创建行使实际业务逻辑的数据

**全面覆盖：**
- 快乐路径场景
- 错误条件和异常
- 边缘情况和边界条件
- 集成点和依赖关系

**可维护代码：**
- 描述正在测试内容的清晰测试名称
- 组织良好的测试结构
- 适当使用设置/拆卸
- 最少的测试数据和模拟

## 高级功能

**模式跟踪：**
当提供测试示例时，工具分析：
- 命名约定和结构
- 断言模式和样式
- 模拟和设置方法
- 测试数据组织

**大上下文分析：**
使用像Gemini Pro这样的模型，工具可以：
- 分析广泛的代码库以获得全面的测试覆盖
- 理解跨多个模块的复杂交互
- 生成跨多个组件的集成测试

**视觉测试：**
对于UI组件和视觉元素：
- 基于视觉需求生成测试
- 创建可访问性测试场景
- 测试响应式设计行为

## 何时使用TestGen与其他工具

- **使用`testgen`**：创建全面测试套件、填补测试覆盖差距、测试新功能
- **使用`debug`**：诊断特定测试失败或运行时问题
- **使用`codereview`**：审查现有测试质量和覆盖率
- **使用`analyze`**：理解现有测试结构而不生成新测试
